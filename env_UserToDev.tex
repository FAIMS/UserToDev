\startenvironment env_UserToDev
\enableregime [utf]
\mainlanguage [en]
\setuppapersize[A5][A5]
\setupexternalfigures[directory={./images, ../img, /data/images/}]
%\usemodule[simplefonts]
%\setmainfont[Adventor][expansion=quality,protrusion=quality]
\setupcolors[state=start]
\definecolor[faimsblue][ c=1, m=.91, y=.03, k=.02]
\definecolor[faimsorange][ c=.5, m=.91, y=.91, k=.02]
\setupinteraction[state=start, color=blue, contrastcolor=blue, style={\tf}]


%TODO lookup faims orange

\definefontfeature
  [default]
  [default]
  [protrusion=quality,expansion=quality]

\setupbodyfont[11pt]  

\setuplayout[location=middle,
backspace=.1\pagewidth,  
height=.9\pageheight, 
width=.8\pagewidth, 
topspace=.025\pageheight, 
header=.05\pageheight, 
footer=.05\pageheight, 
bottomspace=.025\pageheight, 
marking=on]
\setuppagenumbering [alternative=doublesided, location={bottom, right}]

\setuphead[title][aligntitle=float, page=no, style={\tfd}]
\setupheads[aligntitle=float, page=no]
\setupwhitespace[big]

\definetextbackground[longcode][
        background=color,backgroundcolor=gray,
        backgroundoffset=0.2cm,
        location=paragraph,
%        topoffset=.5\bodyfontsize,bottomoffset=.5\bodyfontsize,
        offset=3cm,
        margin=1cm,
 		before={\startnarrower},
        after={\stopnarrower},        
        frame=off]


\definetextbackground[verbatim]
[background=color,
backgroundcolor=yellow,
backgroundoffset=0cm,
offset=0.5cm,
frame=on,
framecolor=black,
location=paragraph,
color=black]

\definetyping[longcodetyping]
\setuptyping[longcodetyping][option=xml, tab=4, style={\tfx\tt},
lines=yes,bodyfont=8.0pt,
before={\starttextbackground[longcode]},
after={\stoptextbackground}]


\setuptyping[lines=yes]



\definefloat[quiz][quizzes]
\setupfloat[quiz][label={Test Your Knowledge}]
\setupcaption[testk][location=bottom,headstyle=boldslanted]

\define[2]\quiz{%


\setupcaption[quiz][location=top]
\blank[line]
\placefloat[quiz][here][block:bridge]{#1}
\startframedtext[align={hanging, hz},
				 width=.9\makeupwidth,
				background=color,
				backgroundcolor=gray,
				corner=round,
				framecolor=faimsblue,
				rulethickness=2pt				
				 ]
				 \setupwhitespace[big]
				 \startitemize[n]
				 {
#2				 
}
\stopitemize
\stopframedtext}

\definefloat[alert]
\define[1]\alert{%
\placealert[none, here]{~}{
\startframedtext[align={hanging, hz},
				 width=.8\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=faimsorange,
				rulethickness=1pt				
				 ]
				 
{\bf #1}		 

\stopframedtext
}}

\definefloat[code]

\setupcaption[code][location=below, width=.8\textwidth]
%TODO Figure out how to make smaller and indented.

\define[2]\code{%
\placecode[here]{#1}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
				 
\type[style={\tfx\tt}]{ #2}		 

\stopframedtext
}}




\define[2]\prompt{%
\placecode[here]{#1}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\startitemize[5]				 
#2
\stopitemize

\stopframedtext
}}





\define[3]\promptref{%
\placecode[here][#1]{#2}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\startitemize[5]				 
#3
\stopitemize

\stopframedtext
}}

\define[1]\bashprompt{%
\item\type[style={\tfx\tt}, numbering=line]{ #1}		 
}

\definesymbol[5][\$]
%TODO figure out how to get this \tt




%TODO figure out how to eliminate caption

\setupcombinedlist[chapter][style={\setupwhitespace[small]}]
\setupcombinedlist[section][style={\setupwhitespace[small]}]

%todo singlespaced TOC

\setupitemize[packed, joinedup]
				

\enabledirectives[logs.errors]
\setupalign[hanging, hz]
%\enabletrackers[typesetters.suspects]
\stopenvironment