\startcomponent[AdvancedProgramming]
\starttext

\section[advanced-faims-programming]{Advanced FAIMS Programming}

\subsection[module.xml-cheat-sheet]{module.xml Cheat Sheet}

For more information about the different XML attributes, flags, and relationship tags, we have a README file that you can access online here: \useURL[url24][https://github.com/FAIMS/FAIMS-Tools/blob/master/generators/christian/readme][][{\em https://github.com/FAIMS/FAIMS-Tools/blob/master/generators/christian/readme}]\from[url24] or in the generators/christian/ directory where you downloaded the FAIMS-Tools.

We'll repeat some of the information here for your reference. Be sure to open the README for the most up to date information: to learn how to include more advanced controls and scripting in your modules, look at the \useURL[url25][https://faimsproject.atlassian.net/wiki/display/FAIMS/FAIMS+Data\%2C+UI+and+Logic+Cook-Book][][{\em FAIMS Development Cookbook}]\from[url25], which includes code snippets for all of the things FAIMS can do.

ATTRIBUTES\crlf
\crlf
b Binding (See 'Bindings')\crlf
c Alias for faims_style_class\crlf
e="Type" Populates the menu with entities of the type `Type`. If the\crlf
`Type` is the empty string, entities of all types are shown.\crlf
ec, lc (See 'Child Entities')\crlf
f Flags (See 'Flags')\crlf
l Link to tab or tab group in the format Tabgroup/Tab/. Links\crlf
to tabs are discouraged as the generated code will contain\crlf
a race condition. Autogenerated code containing tab links\crlf
should be thoroughly tested.\crlf
p In {\tt <opt>} tags, equivalent to pictureURL attribute.\crlf
suppressWarnings Prevents warnings from being shown when equal to "true" and\crlf
present in the {\tt <module>} tag. Does not suppress errors.\crlf
t Type of GUI element (See 'Types'). If this attribute is\crlf
omitted from a view, t="input" is assumed.\crlf
________________________________________________________________________________\crlf
\crlf
BINDINGS\crlf
\crlf
- date\crlf
- decimal\crlf
- string\crlf
- time\crlf
Other bindings are possible (e.g. by writing b = "my-binding") but generate a\crlf
warning.\crlf
________________________________________________________________________________\crlf
\crlf
FLAGS\crlf
\crlf
hidden Equivalent to faims_hidden="true".\crlf
id Equivalent to isIdentifier="true".\crlf
noannotation Equivalent to faims_annotation="false".\crlf
nocertainty Equivalent to faims_certainty="false".\crlf
nolabel Prevents labels from being displayed or generated from element\crlf
names.\crlf
nosync Removes the faims_sync="true" attribute from audio, camera,\crlf
file and video GUI elements.\crlf
nothumb{[}nail{]} Removes the thumbnail="true" attribute from audio, camera,\crlf
file and video elements in the data schema.\crlf
noscroll Equivalent to faims_scrollable="false".\crlf
noui Only allows code related to the data schema to be generated.\crlf
nodata Generates code as usual, but ommits data schema entries.\crlf
readonly Equivalent to faims_read_only="true".\crlf
user Used to indicate that a menu should contain a list of users.\crlf
notnull Adds client- and server-side validation specifying that the\crlf
field should not be left blank.\crlf
________________________________________________________________________________\crlf
\crlf
TYPES\crlf
\crlf
Types of GUI element:\crlf
- audio {\tt <select type="file" faims_sync=true/>}\crlf
{\tt <trigger/>}\crlf
- button {\tt <trigger/>}\crlf
- camera {\tt <select type="camera" faims_sync=true/>}\crlf
{\tt <trigger/>}\crlf
- checkbox {\tt <select/>}\crlf
- dropdown {\tt <select1/>}\crlf
- file {\tt <select type="file" faims_sync=true/>}\crlf
{\tt <trigger/>}\crlf
File list with a button to add a file\crlf
\crlf
- gpsdiag {\tt <input faims_read_only="true"/>}...\crlf
- group {\tt <group/>}\crlf
- input {\tt <input/>}\crlf
- list {\tt <select1 appearance="compact"/>}\crlf
- map {\tt <input faims_map="true"/>}\crlf
- picture {\tt <select1 type="image"/>}\crlf
- radio {\tt <select1 appearance="full"/>}\crlf
- video {\tt <select type="file" faims_sync=true/>}\crlf
{\tt <trigger/>}\crlf
- viewfiles {\tt <trigger/>}\crlf
A button to view all files related to an archent.\crlf
- web{[}view{]} {\tt <input faims_web="true"/>}\crlf
________________________________________________________________________________\crlf
\crlf
RESERVED ELEMENT NAMES AND RECOMMENDED NAMING CONVENTIONS\crlf
\crlf
"Reserved" elements only contain lowercase letters:\crlf
- {\tt <col>} One column in a {\tt <cols>} tag\crlf
- {\tt <cols>} Columns\crlf
- {\tt <desc>} Description to put in the data schema\crlf
- {\tt <module>}\crlf
- {\tt <opt>} Option in {\tt <opts>} tag\crlf
- {\tt <opts>} Options for, say, a dropdown menu\crlf
- {\tt <rels>} Intended to be a direct child of {\tt <module>} and hold\crlf
{\tt <RelationshipElement>} tags\crlf
- {\tt <gps>} A set of fields including Latitude, Longitude, Northing,\crlf
Easting and a "Take From GPS" button.\crlf
- {\tt <search>} A tab for searching all records. Its text is used as a label.\crlf
- {\tt <str>} Contains {\tt <formatString>}-related data.\crlf
- {\tt <pos>} When the child of a {\tt <str>}, gives the position (order) of an\crlf
identifier in a formatted string\crlf
- {\tt <fmt>} When the child of a {\tt <str>}, contains {\tt <formatString>} data.\crlf
- {\tt <app>} When the child of a {\tt <str>}, contains {\tt <appendCharacterString>}\crlf
data.\crlf
- {\tt <author>} A read-only field displaying the username of the current user\crlf
or a message if the entity it appears in has not been saved.\crlf
- {\tt <timestamp>} A read-only field displaying the creation time of the entity\crlf
it appears in.\crlf
User-defined elements should start with an uppercase letter and use\crlf
underscores as separators:\crlf
- {\tt <My_User_Defined_Element t="dropdown" />}\crlf
Neither of these naming conventions are strictly enforced however.\crlf
________________________________________________________________________________\crlf
\crlf
INTENDED PURPOSE OF THE {\tt <rels>} TAG\crlf
\crlf
When placed as a direct child of the {\tt <module>} element, contents of the {\tt <rels>}\crlf
tag are copied as-is to the generated data schema. No warnings are shown if\crlf
something is awry with its contents.\crlf
\crlf
Because the {\tt <rels>} tags' contents are directly copied, in principle you could\crlf
put anything in there which you want to appear in the data schema. Doing so\crlf
would make you a bad person.\crlf
________________________________________________________________________________\crlf
\crlf
SEMANTICS OF {\tt <cols>} TAGS\crlf
\crlf
Direct children of {\tt <cols>} tags are interpreted as columns. For example:

\placecode[here][codeColumns]{Each field forms a new column.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
	<cols>
		<Field_1 t="input"/>
		<Field_2 t="input"/>
		<Field_3 t="input"/>
	</cols>
\stoptyping
\stopframedtext
}

has three columns, each containing an input. The left-most column is Field_1, whereas the right-most is Field_3.\crlf
\crlf
When a {\tt <col>} tag is a direct child, its contents are interpreted as being part of a distinct column. Therefore,

\placecode[here][codeComColumns]{Fields between {\tt <col>} and {\tt </col>} are in the same columns.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
	<cols>
		<Field_1 t="input"/>
		<col>
			<Field_2 t="input"/>
			<Field_3 t="input"/>
		</col>
	</cols>
\stoptyping
\stopframedtext
}

results in two columns. The left column contains Field_1, while the right contains Field_2 and Field_3.\crlf
________________________________________________________________________________\crlf
\crlf
CHILD ENTITIES\crlf
\crlf
Entities can be saved as children by the use of the "lc" attribute. For\crlf
instance, writing\crlf
{\tt <Add_Child t="button" lc="Child_Ent" />}\crlf
generates a button which links to the Child_Ent tab group. When displayed by\crlf
clicking the Add_Child button, the Child_Ent tab group will have auto-saving\crlf
enabled and be saved as a child of the tab group that the button appeared in.\crlf
For example, consider the following module.xml:

\placecode[here][codeSavingChildren]{XML to save entities as children.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
	<module>
		<Tab_Group>
			<Tab>
				<Add_Child t="button" lc="Tab_Group" />
			</Tab>
		</Tab_Group>
	</module>
\stoptyping
\stopframedtext
}

Clicking the Add_Child button will cause the user to be taken to a new\crlf
instance of Tab_Group which will be saved as a child of the original instance.\crlf
But because the original instance was not loaded by clicking the button, it\crlf
will not be saved as a child.\crlf
\crlf
A list of child entities can be displayed to the user by using the "ec"\crlf
attribute:\crlf

\placecode[here][codeListOfChildren]{XML to display a list of child entities.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
	<List_Of_Related_Entities t="list" ec="Type_Of_Childen" />\crlf
\stoptyping
\stopframedtext
}

The list will be populated with entities which are children of the tab group\crlf
the list appears in. The entities will be constrained to have the type\crlf
"Type_Of_Children". However, writing `ec=""` produces an unconstrained list,\crlf
where children of all types are displayed.\crlf
\crlf
The user should note carefully that, while including an "lc" attribute causes\crlf
a corresponding {\tt <RelationshipElement>} to be generated in the data schema,\crlf
including an "ec" attribute does not.\crlf
________________________________________________________________________________\crlf
\crlf
LABELS\crlf
\crlf
An element's text is taken as its label. For instance, the following input

\placecode[here][codeInputLabeless]{Labeless input.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
	<My_Input t="input">
		Droopy Soup
		<desc>Similar to drippy soup, but not quite...</desc>
	</My_Input>
\stoptyping
\stopframedtext
}

has the label "Droopy Soup". Note that following and preceding whitespace is\crlf
stripped.\crlf
\crlf
If a label is not provided, it is "inferred" from the element's name. More\crlf
specifically, underscores in the element's name are replaced with spaces,\crlf
which becomes the element's label. Therefore, the element

\placecode[here][codeOverlappingLabel]{Different input, same label.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
	<Droopy_Soup t="input">
		<desc>Similar to drippy soup, but not quite...</desc>
	</Droopy_Soup>
\stoptyping
\stopframedtext
}

has the same label as in the above example. Thus, the user will see exactly\crlf
the same thing in both cases. However, their representations in the data and\crlf
UI schemas, and the arch16n file will be different.\crlf
\crlf
You are recommended to use this "inference" feature, as it encourages\crlf
consistency between the label, which the user sees, and the view's reference\crlf
and faims_attribute_name, which the programmer sees. Note that it merely\crlf
"encourages" consistency as the programmer can change the corresponding,\crlf
generated, arch16n (english.0.properties) entry.\crlf
________________________________________________________________________________\crlf
\crlf
GENERATION OF THE ARCH16N FILE\crlf
\crlf
Labels and menu options (e.g. from checkboxes and dropdowns) have arch16n\crlf
entries generated for them. The left-hand side of an arch16n entry (i.e.\crlf
everything to the left of the equals sign) is produced by changing all\crlf
non-alphanumeric characters in the label or menu option to underscores. The\crlf
right-hand side is the unmodified text.\crlf
\crlf
The created arch16n entries are used in the generated UI and data schemas.\crlf
\crlf
It should be carefully noted that replacing characters as described above can\crlf
cause naming conflicts. For example, if the module.xml file contains the\crlf
labels "I'm cool!" and "I'm cool?", the generated arch16n file will contain\crlf
the following lines:\crlf
I_m_cool_=I'm cool!\crlf
I_m_cool_=I'm cool?\crlf
Moreover, the programmer is not warned if such a conflict exists, as, in\crlf
practise, it assumed that such conflicts are very rare and checking for them\crlf
in XSLT 1.0 violates Article 5 of 'The Universal Declaration of Human Rights'.


\stoptext
\stopcomponent