\startcomponent[MatchModule]
\starttext


\section[iterating-to-match-the-oral-history-module]{Iterating to Match the Oral History Module}

Now that we've created a very straightforward version of the Oral History module, let's layer in some additional features. By the end of this section, we will have discussed all the steps that went into making the version of the Oral History Module you can download from the FAIMS Demo Server.

Select "Demo Server" from the dropdown menu in the FAIMS setting menu, then download the "finished" version of the Oral History module. Our goal in this section will be to update the version you produced to match this more complex iteration.

\placefigure[force][OHD]{Tap "Oral History Demo" to download.}{\externalfigure[image48.png][width=.5\textwidth]}

The Oral History module has a bit more metadata information included than the version we've already discussed. You can update this information in the "Module" tab on your FAIMS server installation.

\placefigure[force][OHD-metadata]{More detailed metadata.}{
\startcombination[2*1]
{\externalfigure[image33.png][width=.5\textwidth]}{}
{\externalfigure[image59.png][width=.5\textwidth]}{}
\stopcombination
}

The first screen of the Oral History Demo (\in{Figure}[user-list]) looks similar to our module.

\placefigure[force][user-list]{Match your model to "Oral History Demo" by adding a User List.}{\externalfigure[image31.png][width=.5\textwidth]}

In the same module.xml file we used for our version of Oral History update the code in \in{Codeblock}[codeOutdatedUserList] to match \in{Codeblock}[codeUpdatedUserList] (new code in {\bf bold}).

\placecode[here][codeOutdatedUserList]{Current code.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<User f="nodata">
	<User>
		<Select_User t="dropdown" f="user"/>
		<Login t="button" l="Control"/>
	</User>
</User>		
\stoptyping
\stopframedtext
}

\placecode[here][codeUpdatedUserList]{This code replicates "Oral History Demo".}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<User f="nodata">
	{\bf <User_List>}
		{\bf <Users t="list" f="user" l="Control">}
			{\bf Users:}
		{\bf </Users>}
	{\bf </User_List>}
</User>		
\stoptyping
\stopframedtext
}

This replicates the "User List" tab illustrated in the above screenshot. 

Save your modified module.xml, run "{\em ./generate.sh}" in your Ubuntu terminal again, edit your current module and upload the new necessary files in place of the old ones. Now download this updated module to your FAIMS app. 

Importantly, to download the updated version of the module, you must touch and hold the "Simple Sample Module" in the list of modules until the dialogue in \in{Figure}[SSM-popup] is displayed.

\placefigure[force][SSM-popup]{Tap and hold "Simple Sample Module" to open this pop-up.}{\externalfigure[image14.png][width=.5\textwidth]}

Tap "Update", then "Update Settings", wait for the update to occur, and finally load the module as usual.

\alert{\bf Note: While we can update Simple Sample Module to have an interface that mimics the Oral History module, we're going to make some changes that will make the module not completely functional. This is because, as you may recall, you can't change the Data Schema of a module once it's already been uploaded to the server. So the interface elements will look right, because the necessary files that govern those can be changed out freely, but the parts actually responsible for managing the data you collect to the server won't have gotten the memo that the module's been altered. If this weren't an exercise, and we wanted an absolutely functional module, we'd just create a new one from the updated necessary files and tell our team members to switch to it.} 

\placefigure[force][OHD-control]{"Oral History Demo" combines "Main" and "Record" into "Control".}{\externalfigure[image24.png][width=.5\textwidth]}

On the screen in \in{Figure}[OHD-control], we need to condense a few elements from our original module. Change the code in \in{Codeblock}[codeOutdatedCondenseTabs] to match the code in \in{Codeblock}[codeUpdatedCondenseTabs].

\placecode[here][codeOutdatedCondenseTabs]{Current code.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<Control f="nodata">
	<Main>
		<Record_Interview t="button" l="Interview"/>
		<GPS_Diagnostics t="gpsdiag"/>
	</Main>
	<search>
		Records
	</search>
</Control>		
\stoptyping
\stopframedtext
}

\placecode[here][codeUpdatedCondenseTabs]{Condense "Main" and "Record" into "Control".}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<Control f="nodata">
	{\bf <Control>}
		{\bf <New_Oral_History_Form t="button" l="Form"/>}
		{\bf <New_Diary t="button" l="Diary"/>}
		{\bf <GPS_Diagnostics t="gpsdiag"/>}
		{\bf <Sample_Types t="dropdown" />}
		{\bf <List_of_Samples t="list" />}
	{\bf </Control>}
</Control>		
\stoptyping
\stopframedtext
}

\in{Codeblock}[codeUpdatedCondenseTabs] replaces the "Main" and "Record" tab groups with a single one labelled "Control". (In a moment, we will define the "Form" and "Diary" tab groups linked to by the above buttons. We will also have to populate the "Sample Types" dropdown and "List of Samples" list by writing some additional code.)

Save module.xml and run the generate.sh script again. Now use them to update your module again. You should see something similar to \in{Figure}[SSM-control] after selecting a user in the uploaded module.

\placefigure[force][SSM-control]{"Control" tab in your updated module.}{\externalfigure[image8.png][width=.5\textwidth]}

For the next step, we'll add new UI tab groups for each of our buttons: "Form" and "Diary" that we linked to in \in{Codeblock}[codeFormDiary].

\placecode[here][codeFormDiary]{Add "Form" and "Diary" tab groups.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<Form>
	<Recording_Form>
	</Recording_Form>
	<Interview_Details>
	</Interview_Details>
	<Main_Subjects>
	</Main_Subjects>
</Form>
<Diary>
	<Diary>
	</Diary>
</Diary>		
\stoptyping
\stopframedtext
}

Make sure that the {\tt <Form>} and {\tt <Diary>} elements are written directly within {\tt <module>} so that the FAIMS-Tools correctly interprets them as tab groups. It may help, when drafting new elements, to write both the opening and closing tags and then fill in the middle.

Now, under each of these new tab groups, we'll create individual tabs. The "Form" group has three tabs: "Recording Form", "Interview Details", and "Main Subjects". Note that if these tab titles contain multiple words, you must use underscores between each word. When FAIMS creates the title for each tab, underscores will be replaced with spaces.

\placefigure[force][empty-tab]{Three newly created empty tabs.}{\externalfigure[image53.png][width=.5\textwidth]}

Now we have the individual tabs for each section, but those tabs don't have any content just yet. For simple text fields, like "Birth Place" and "Parents' Birth Place" you can simply add a self-closing tag with the field's title as in \in{Codeblock}[codeBirthPlace].

\placecode[here][codeBirthPlace]{A self-closing "Birth Place" tag.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<BIRTH_PLACE />
\stoptyping
\stopframedtext
}

Also, non-alphabetical characters, like apostrophes are not allowed as tag names in XML, so the FAIMS-Tools would fail to generate a module which contains the code in \in{Codeblock}[codeApostropheFail].

\placecode[here][codeApostropheFail]{The apostrophe causes this to fail.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<PARENTS'_BIRTH_PLACE:/>
\stoptyping
\stopframedtext
}

If such characters must be included, the solution is to firstly give the element a sensible name without an apostrophe or colon as in \in{Codeblock}[codeApostropheFix].

\placecode[here][codeApostropheFix]{First name the element without an apostrophe.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<PARENTS_BIRTH_PLACE/>
\stoptyping
\stopframedtext
}

Then, to make FAIMS-Tools display the apostrophe and colon in the GUI, write them as the element's text as in \in{Codeblock}[codeApostropheFix2].

\placecode[here][codeApostropheFix2]{Write any special characters in the element's text.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<PARENTS_BIRTH_PLACE>
	PARENTS' BIRTH PLACE:
</PARENTS_BIRTH_PLACE>
\stoptyping
\stopframedtext
}

This is similar to what we did with the "search" feature in the last section.

Now, note that every tab group which you intend to save requires at least one {\em identifier}. In the original Oral History module, the identifiers were "PERSON" and "LANGUAGE_GROUP". We can use the "f" attribute to denote that in our new module as in \in{Codeblock}[codeDenoteID].

\placecode[here][codeDenoteID]{Denoting an {\em identifier}.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<PERSON f="id"/>\crlf
<LANGUAGE_GROUP f="id"/>
\stoptyping
\stopframedtext
}

For the GPS fields and their corresponding "Take From GPS" button, refer to \in{Codeblock}[codeGPS]. {\tt <gps>} is a special, self-contained shortcut tag that FAIMS will replace with several fields for the latitude, longitude, Easting, and Northing, as well as a button for inserting this data from GPS.

\placecode[here][codeGPS]{XML for GPS fields and button.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<gps/>
\stoptyping
\stopframedtext
}

To add fields for attached files, you can use the "Audio" and "Video" tags, as in \in{Codeblock}[codeAVtag]. Simply set the type "t" to video or audio as required.

\placecode[here][codeAVtag]{XML for attaching audio and visual files.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<Attached_Audio_Files t="audio" />
<Attached_Videos t="video" />
\stoptyping
\stopframedtext
}


\placefigure[force][input-examplees]{Examples of simple text fields, GPS input, and attaching files.}{
\startcombination[3*1]
{\externalfigure[image26.png][width=.3\textwidth]}{}
{\externalfigure[image15.png][width=.3\textwidth]}{}
{\externalfigure[image52.png][width=.3\textwidth]}{}
\stopcombination
}

To add the radio buttons, use the code in \in{Codeblock}[codeRadioButtons].

\placecode[here][codeRadioButtons]{XML for radio buttons.}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<Recorded t="radio">
	Recorded?
	<opts>
		<opt>Recorded</opt>
		<opt>Notes Only</opt>
		<opt>No</opt>
	</opts>
</Recorded>		
\stoptyping
\stopframedtext
}

Note that to have the radio buttons' contents appear would require that the entire module is re-created and uploaded to the FAIMS server. Updating the existing module on the server, would cause the menu to appear but lack its options.

\placefigure[force][radio-buttons]{Radio buttons in "Interview Details" and a simple text field in "Main Subjects".}{
\startcombination[2*1]
{\externalfigure[image42.png][width=.5\textwidth]}{}
{\externalfigure[image49.png][width=.5\textwidth]}{}
\stopcombination
}

The "Timestamp" and "Created By" values are not actually fields that we'll allow users to enter in manually, so we won't put in a data entry field. Instead, we'll make FAIMS set and update these fields when the record is created. Since there's no simple shortcut for that, for now we'll put in the code in \in{Codeblock}[codeTimeCreated].

\placecode[here][codeTimeCreated]{XML for "Timestamp" and "Created by".}{
\startframedtext[align={hanging, hz},
				 width=\makeupwidth,
				background=color,
				backgroundcolor=gray,				
				framecolor=gray,
				rulethickness=1pt				
				 ]
\starttyping[option=xml, tab=4, style={\tfx\tt}] 
<Timestamp/>
<Created_by/>
\stoptyping
\stopframedtext
}

There's actually not a lot more we can do until we've generated our necessary files. Then, we'll take ui_logic.bsh and make a few alterations that make use of these tags.

\placefigure[force][autofill]{"Timestamp" and "Created by" are automatically filled in by FAIMS.}{
\startcombination[2*1]
{\externalfigure[image37.png][width=.5\textwidth]}{}
{\externalfigure[image1.png][width=.5\textwidth]}{}
\stopcombination
}

\stoptext
\stopcomponent